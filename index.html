<html>
	<head>
		<link rel="stylesheet" type="text/css" href="static/main.css"/>
		<link rel="stylesheet" type="text/css" href="xTags/branding/xBranding.css"/>
		<link rel="stylesheet" type="text/css" href="lib/brick-0.9.2.min.css"/>

		<script type='text/javascript' src='lib/brick-0.9.2.min.js'></script>
		<script type='text/javascript' src='lib/dygraph-1.0.1.min.js'></script>
		<script type='text/javascript' src='xTags/branding/xBranding.js'></script>
		<script type='text/javascript' src='static/grif16.js'></script>
		<script type='text/javascript' src='static/mscb.js'></script>
	</head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">

	<body>

		<div id='wrapper'>
			<branding-head experiment='GRIFFIN' subline='GRIF16ADC'></branding-head>

			<div id='mainContent'>
				<div id='nav'>
					<input id='swap0' name='view', onclick='cycleTo(0)' type='radio' checked></input>
					<label for='swap0'>ADC 0</label>
					<input id='swap1' name='view', onclick='cycleTo(1)' type='radio'></input>
					<label for='swap1'>ADC 1</label>
					<input id='swap2' name='view', onclick='cycleTo(2)' type='radio'></input>
					<label for='swap2'>ADC 2</label>
					<input id='swap3' name='view', onclick='cycleTo(3)' type='radio'></input>
					<label for='swap3'>ADC 3</label>
					<input id='swap4' name='view', onclick='cycleTo(4)' type='radio'></input>
					<label for='swap4'>ADC 4</label>
					<input id='swap5' name='view', onclick='cycleTo(5)' type='radio'></input>
					<label for='swap5'>ADC 5</label>
					<input id='swap6' name='view', onclick='cycleTo(6)' type='radio'></input>
					<label for='swap6'>ADC 6</label>
					<input id='swap7' name='view', onclick='cycleTo(7)' type='radio'></input>
					<label for='swap7'>ADC 7</label>
					<input id='swap8' name='view', onclick='cycleTo(8)' type='radio'></input>
					<label for='swap8'>ADC 8</label>
					<input id='swap9' name='view', onclick='cycleTo(9)' type='radio'></input>
					<label for='swap9'>ADC 9</label>
					<input id='swap10' name='view', onclick='cycleTo(10)' type='radio'></input>
					<label for='swap10'>ADC 10</label>
					<input id='swap11' name='view', onclick='cycleTo(11)' type='radio'></input>
					<label for='swap11'>ADC 11</label>
					<input id='swap12' name='view', onclick='cycleTo(12)' type='radio'></input>
					<label for='swap12'>ADC 12</label>
					<input id='swap13' name='view', onclick='cycleTo(13)' type='radio'></input>
					<label for='swap13'>ADC 13</label>
					<input id='swap14' name='view', onclick='cycleTo(14)' type='radio'></input>
					<label for='swap14'>ADC 14</label>
					<input id='swap15' name='view', onclick='cycleTo(15)' type='radio'></input>
					<label for='swap15'>ADC 15</label>


				</div>
				<div id='plotTarget'></div>
				<div id='control'>
					<div id='ADC' class='collapse'>
						<h3 class='sectionHead' onclick='toggleSection.bind(this, "ADC")()'>&#9654 ADC Control</h3>
						<ul>
							<li>
								<label>DC Offset:</label>
								<input id='a_dcofst' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>mV</label>
							</li>
							<li>
								<label>DC Offset:</label>
								<input id='DCenable' type='radio' name='a_off' value='enabled' checked></input>
								<label for='DCenable'>Enabled</label>
								<input id='DCdisable' type='radio' name='a_off' value='disabled'></input>
								<label for='DCdisable'>Disabled</label>
							</li>
							<li>
								<label>Polarity:</label>
								<input id='posPol' type='radio' name='a_pol' value='positive' checked></input>
								<label for='posPol'>Positive</label>
								<input id='negPol' type='radio' name='a_pol' value='negative'></input>
								<label for='negPol'>Negative</label>
							</li>
							<li>
								<label>Gain Setting:</label>
								<input id='gainA' type='radio' name='a_fgain' value='gainA' checked></input>
								<label for='gainA'>A</label>
								<input id='gainB' type='radio' name='a_fgain' value='gainB'></input>
								<label for='gainB'>B</label>
							</li>
						</ul>
					</div>

					<div id='trig' class='collapse'>
						<h3 class='sectionHead' onclick='toggleSection.bind(this, "trig")()'>&#9654 Triggering</h3>
						<ul>
							<li>
								<label>Channel:</label>
								<input id='chanEnable' type='radio' name='t_off' value='enabled' checked></input>
								<label for='chanEnable'>Enabled</label>
								<input id='chanDisable' type='radio' name='t_off' value='disabled'></input>
								<label for='chanDisable'>Disabled</label>
							</li>
							<li>
								<label>Hit Threshold:</label>
								<input id='t_hthres' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Trig Threshold:</label>
								<input id='t_thres' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Differentiation:</label>
								<input id='t_diff' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Integration:</label>
								<input id='t_int' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Delay:</label>
								<input id='t_delay' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Pole Cxn:</label>
								<input id='t_polcor' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>BLR Control:</label>
								<input id='t_blrctl' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
						</ul>
					</div>

					<div id='pulseHeight' class='collapse'>
						<h3 class='sectionHead' onclick='toggleSection.bind(this, "pulseHeight")()'>&#9654 Pulse Height Evaluation</h3>
						<ul>
							<li>
								<label>Integration:</label>
								<input id='p_int' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Differentiation:</label>
								<input id='p_diff' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Delay:</label>
								<input id='p_delay' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Pole Cxn 1:</label>
								<input id='p_polec1' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Pole Cxn 2:</label>
								<input id='p_polec2' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Baseline Rest.:</label>
								<input id='p_bsr' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Gain:</label>
								<input id='p_gain' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Pileup Algo:</label>
								<input id='p_pactrl' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
						</ul>
					</div>

					<div id='time' class='collapse'>
						<h3 class='sectionHead' onclick='toggleSection.bind(this, "time")()'>&#9654 Time Evaluation</h3>
						<ul>
							<li>
								<label>CFD Delay:</label>
								<input id='cfd_dly' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>CFD Fraction:</label>
								<input id='cfd_frac' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
						</ul>
					</div>

					<div id='waveform' class='collapse'>
						<h3 class='sectionHead' onclick='toggleSection.bind(this, "waveform")()'>&#9654 Waveform Readout</h3>
						<ul>
							<li>
								<input id='suppressedWF' type='radio' name='wfr_supp' value='suppressed' checked></input>
								<label for='suppressedWF'>Suppressed</label>
								<input id='unsuppressedWF' type='radio' name='wfr_supp' value='unsuppressed'></input>
								<label for='unsuppressedWF'>Unsuppressed</label>
							</li>
							<li>
								<label>Pretrigger:</label>
								<input id='wfr_pret' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Samples:</label>
								<input id='wfr_smpl' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Decimation:</label>
								<input id='wfr_dec' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Filter WF:</label>
								<input id='enableWFfilter' type='radio' name='wfr_off' value='enabled' checked></input>
								<label for='enableWFfilter'>Enabled</label>
								<input id='disableWFfilter' type='radio' name='wfr_off' value='disabled'></input>
								<label for='disableWFfilter'>Disabled</label>
							</li>
						</ul>
					</div>

					<div id='simulation' class='collapse'>
						<h3 class='sectionHead' onclick='toggleSection.bind(this, "simulation")()'>&#9654 Simulation Pulse</h3>
						<ul>
							<li>
								<input id='enableSim' type='radio' name='sim_ena' value='enabled' checked></input>
								<label for='enableSim'>Enabled</label>
								<input id='disableSim' type='radio' name='sim_ena' value='disabled'></input>
								<label for='disableSim'>Disabled</label>
							</li>
							<li>
								<label>Pulse Height:</label>
								<input id='sim_phgt' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Risetime:</label>
								<input id='sim_rise' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Falltime:</label>
								<input id='sim_fall' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Rate:</label>
								<input id='sim_rate' type='number' step='any' onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Period:</label>
								<input id='periodRand' type='radio' name='sim_rand' value='random' checked></input>
								<label for='periodRand'>Random</label>
								<input id='periodFix' type='radio' name='sim_rand' value='fixed'></input>
								<label for='periodFix'>Fixed</label>
							</li>
						</ul>
					</div>

					<div id='misc' class='collapse'>
						<h3 class='sectionHead' onclick='toggleSection.bind(this, "misc")()'>&#9654 Miscellaneous</h3>
						<ul>
							<li>
								<label>Fixed Deadtime:</label>
								<input id='fix_dead' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
							<li>
								<label>Detector Type:</label>
								<input id='det_type' type='number' step=1 onchange='updateADC.bind(this)()'></input>
								<label>units</label>
							</li>
						</ul>
					</div>

				</div>
			</div>

			<div id='push'></div>
		</div>

		<branding-foot></branding-foot>

		<script>
			document.addEventListener('DOMComponentsLoaded', function(){
				window.ADCparameters = [];

				window.typeLookup = {
					'a_pol': 'bool',
					'a_off': 'bool',
					'a_fgain': 'bool',
					'a_dcofst': 'int',
					//'a_trim': 'int',
					//'a_status': 'int',
					'ch_en': 'int',
					'ch_aa': 'int',
					't_hthres': 'float',
					't_thres': 'float',
					't_diff': 'int',
					't_int': 'int',
					't_delay': 'int',
					't_polcor': 'float',
					't_blrctl': 'float',
					't_off': 'bool',
					'p_int': 'int',
					'p_diff': 'int',
					'p_delay': 'int',
					'p_polec1': 'float',
					'p_polec2': 'float',
					'p_bsr': 'float',
					'p_gain': 'float',
					'p_pactrl': 'int',
					'cfd_dly': 'int',
					'cfd_frac': 'float',
					'wfr_pret': 'int',
					'wfr_smpl': 'int',
					'wfr_dec': 'int',
					'wfr_supp': 'bool',
					'wfr_off': 'bool',
					'sim_ena': 'bool',
					'sim_phgt': 'float',
					'sim_rise': 'float',
					'sim_fall': 'float',
					'sim_rate': 'float',
					'sim_rand': 'bool',
					'fix_dead': 'int',
					'det_type': 'int'
				}

				cycleTo(0);
				fetchADC();

				window.onkeypress = keypress;

//write test///////////////////////////////////////////////////

	var url = 'http://mscb500.triumf.ca/mscb_rx'
	,	addr = 2
	,	var_id = 7
	,	data = new DataView(new ArrayBuffer(4));
					
    data.setFloat32(0, 7);

	
	console.log('trying MSCB_WriteVar('+url+', '+addr+', '+var_id+', '+data+')' )
	MSCB_WriteVar( url, addr, var_id, data )

			});
		</script>

	</body>
</html>
